!function(){var e=["healthcafe.generic","healthcafe.intro","healthcafe.login","healthcafe.personal","healthcafe.bodymeasurements","healthcafe.bloodpressure","healthcafe.bodyweight","healthcafe.bodyfat","healthcafe.waistcircumference","healthcafe.bmi","healthcafe.bloodglucose","healthcafe.cholesterol","healthcafe.vita16","healthcafe.timeline","healthcafe.remarks","healthcafe.sharing"];angular.module("healthcafe",["ionic","ngMessages","angularUUID2","angular-timeline","indexedDB"].concat(e)).run(["$ionicPlatform",function(e){e.ready(function(){window.cordova&&window.cordova.plugins&&window.cordova.plugins.Keyboard&&(cordova.plugins.Keyboard.hideKeyboardAccessoryBar(!0),cordova.plugins.Keyboard.disableScroll(!0)),window.StatusBar&&StatusBar.styleDefault()})}]);for(idx in e)angular.module(e[idx],[])}(),function(){var e={env:"dev",sharing:{healthcafe:{label:"NRC healthcafe",description:"Healthcafe is een concept, een werk-in-uitvoering, waar u binnnen de werkomgeving zelf bepaalde aspecten van uw gezondheid kan meten en daarop zelf kan acteren.",type:"openmhealth"}},datatypes:[{name:"bloodpressure",controllerPrefix:"BloodPressure",label:"Bloeddruk",creationInMenu:!0},{name:"bodyweight",controllerPrefix:"BodyWeight",label:"Gewicht"},{name:"bodyfat",controllerPrefix:"BodyFat",label:"Lichaamsvet"},{name:"waistcircumference",controllerPrefix:"WaistCircumference",label:"Taille omtrek"},{name:"bmi",controllerPrefix:"BMI",label:"BMI"},{name:"bloodglucose",controllerPrefix:"BloodGlucose",label:"Bloedglucose",creationInMenu:!0},{name:"cholesterol",controllerPrefix:"Cholesterol",label:"Cholesterol",creationInMenu:!0}],questionnaires:[{name:"vita16",controllerPrefix:"Vita16",label:"Vitaliteitsvragenlijst"}],dev:{api:{oauth:{healthcafe:{urls:{authorization:"https://humanstudies.tno.nl/healthcafe/oauth/authorize",redirect:"http://msb2.hex.tno.nl/app-test/app/login/oauth_callback.html?healthcafe",dataPoints:"https://humanstudies.tno.nl/healthcafe/api/openmhealth/v1/dataPoints"},key:"hm2lkbxyssh9vvsn4tjpknavhqifmkzmucrl500o"}}}},test:{api:{oauth:{healthcafe:{urls:{authorization:"https://humanstudies.tno.nl/healthcafe/oauth/authorize",redirect:"http://isdatsoftwareontwikkeling.nl/projecten/healthcafe/app/login/oauth_callback.html?healthcafe",dataPoints:"https://humanstudies.tno.nl/healthcafe/api/openmhealth/v1/dataPoints"},key:"hm2lkbxyssh9vvsn4tjpknavhqifmkzmucrl500o"}}}}};e.current=function(){return e[e.env]},angular.module("healthcafe").constant("config",e).config(["$httpProvider","$indexedDBProvider",function(e,t){e.interceptors.push("OAuth2Interceptor"),t.connection("healthcafe").upgradeDatabase(1,function(e,t,n){datapointsStore=t.createObjectStore("datapoints",{keyPath:"header.id"}),datapointsStore.createIndex("schema",["header.schema_id.namespace","header.schema_id.name","header.schema_id.version"],{unique:!1}),remarksStore=t.createObjectStore("remarks",{keyPath:"id",autoIncrement:!0})}).upgradeDatabase(2,function(e,t,n){answerStore=t.createObjectStore("answers",{keyPath:"id",autoIncrement:!0}),answerStore.createIndex("questionnaire","questionnaire",{unique:!1})})}])}(),function(){angular.module("healthcafe").config(["$stateProvider","$urlRouterProvider","config",function(e,t,n){e.state("app",{url:"/app","abstract":!0,templateUrl:"app/layout.html",controller:"AppController as app"}).state("app.intro",{url:"/intro",views:{mainContent:{templateUrl:"app/intro/intro.html",controller:"IntroController as intro"}}}).state("app.timeline",{url:"/timeline",cache:!1,views:{mainContent:{templateUrl:"app/timeline/timeline.html",controller:"TimelineController as timeline"}}}).state("app.personal_data",{url:"/personal_data",cache:!1,views:{mainContent:{templateUrl:"app/personal/data.html",controller:"PersonalController as personal"}}}).state("app.body_measurements",{url:"/body_measurements",cache:!1,views:{mainContent:{templateUrl:"app/bodymeasurements/data.html",controller:"BodyMeasurementsController as measurements"}}});for(i in n.datatypes){var r=n.datatypes[i];e.state("app."+r.name,{url:"/"+r.name,cache:!1,views:{mainContent:{templateUrl:"app/"+r.name+"/chart.html",controller:r.controllerPrefix+"Controller as "+r.name}}}).state("app."+r.name+"_add",{url:"/"+r.name+"/add",views:{mainContent:{templateUrl:"app/"+r.name+"/create.html",controller:r.controllerPrefix+"CreateController as "+r.name}}}).state("app."+r.name+"_info",{url:"/"+r.name+"/info",views:{mainContent:{templateUrl:"app/"+r.name+"/info.html",controller:"GenericInfoController as info"}}}).state("app."+r.name+"_measurement",{url:"/"+r.name+"/detail/:measurementId",views:{mainContent:{templateUrl:"app/"+r.name+"/detail.html",controller:"GenericDetailController as detail"}}})}for(i in n.questionnaires){var o=n.questionnaires[i];e.state("app."+o.name,{url:"/"+o.name,cache:!1,views:{mainContent:{templateUrl:"app/"+o.name+"/feedback.html",controller:o.controllerPrefix+"Controller as "+o.name}}}).state("app."+o.name+"_answer",{url:"/"+o.name+"/answer",views:{mainContent:{templateUrl:"app/"+o.name+"/answer.html",controller:o.controllerPrefix+"AnswerController as "+o.name}}})}e.state("app.remarks_add",{url:"/remarks/add",views:{mainContent:{templateUrl:"app/remarks/create.html",controller:"RemarksCreateController as remarks"}}}),e.state("app.share",{url:"/share/:service",cache:!1,views:{mainContent:{templateUrl:"app/share/share.html",controller:"ShareController as sharing"}}}),e.state("app.connect",{url:"/share/connect/:service",cache:!1,views:{mainContent:{templateUrl:"app/share/connect.html",controller:"ConnectController as connect"}}}),t.otherwise("/app/intro")}])}(),function(){function e(e){var t=this;return t.datatypes=e.datatypes,t.questionnaires=e.questionnaires,t.sharing=e.sharing,t.groupShown="measurements",t.toggleGroup=function(e){t.isGroupShown(e)?t.groupShown=null:t.groupShown=e},t.isGroupShown=function(e){return t.groupShown==e},t}angular.module("healthcafe").controller("AppController",e),e.$inject=["config"]}(),function(){function e(e,t,n){var r=this;return e.model=n,e.selector=".bloodglucose-container",e.chartableProperties="blood-glucose",e.chartOptions={measures:{"blood-glucose":{valueKeyPath:"body.blood_glucose.value",range:void 0,units:"mmol/L",chart:{pointFillColor:"#4a90e2",pointStrokeColor:"#0066d6"},thresholds:[{name:"Desirable",max:5.8},{name:"Borderline high",min:5.8,max:7.8},{name:"High",min:7.8}]}}},angular.extend(r,t("GenericChartController",{$scope:e})),r}angular.module("healthcafe.bloodglucose").controller("BloodGlucoseController",e),e.$inject=["$scope","$controller","BloodGlucose"]}(),function(){function e(e){return e.getInstance({namespace:"omh",name:"blood-glucose",version:"1.0"},function(e){return e.level?{blood_glucose:{value:e.level,unit:"mmol/L"},temporal_relationship_to_meal:e.relationship_to_meal?e.relationship_to_meal.name:""}:null})}angular.module("healthcafe.bloodglucose").factory("BloodGlucose",e),e.$inject=["Datapoints"]}(),function(){function e(e,t,n){var r=this;return e.model=n,angular.extend(r,t("GenericCreateController",{$scope:e})),r.relationships_to_meal=[{name:"fasting"},{name:"not fasting"}],r}angular.module("healthcafe.bloodglucose").controller("BloodGlucoseCreateController",e),e.$inject=["$scope","$controller","BloodGlucose"]}(),function(){function e(e,t,n){var r=this;return e.model=n,e.selector=".bmi-container",e.chartableProperties="body-mass-index",e.chartOptions={measures:{"body-mass-index":{valueKeyPath:"body.body_mass_index.value",range:void 0,units:"kg/m2",thresholds:{min:18,max:25}}}},angular.extend(r,t("GenericChartController",{$scope:e})),r}angular.module("healthcafe.bmi").controller("BMIController",e),e.$inject=["$scope","$controller","BMI"]}(),function(){function e(e){return e.getInstance({namespace:"omh",name:"body-mass-index",version:"1.0"},function(e){return e.weight&&e.height?{body_mass_index:{value:e.weight/(e.height*e.height),unit:"kg/m2"}}:null})}angular.module("healthcafe.bmi").factory("BMI",e),e.$inject=["Datapoints"]}(),function(){function e(e,t,n){var r=this;return e.model=n,angular.extend(r,t("GenericCreateController",{$scope:e})),r}angular.module("healthcafe.bmi").controller("BMICreateController",e),e.$inject=["$scope","$controller","BMI"]}(),function(){function e(e,t,n){var r=this;return e.model=n,e.selector=".bloodpressure-container",e.chartableProperties="systolic_blood_pressure, diastolic_blood_pressure",e.chartOptions={userInterface:{tooltips:{contentFormatter:function(e){var t=e.omhDatum.body.systolic_blood_pressure.value.toFixed(0),n=e.omhDatum.body.diastolic_blood_pressure.value.toFixed(0);return t+"/"+n}}}},angular.extend(r,t("GenericChartController",{$scope:e})),r}angular.module("healthcafe.bloodpressure").controller("BloodPressureController",e),e.$inject=["$scope","$controller","BloodPressure"]}(),function(){function e(e){return e.getInstance({namespace:"omh",name:"blood-pressure",version:"1.0"},function(e){return e.systolic&&e.diastolic?{systolic_blood_pressure:{value:e.systolic,unit:"mmHg"},diastolic_blood_pressure:{value:e.diastolic,unit:"mmHg"}}:null})}angular.module("healthcafe.bloodpressure").factory("BloodPressure",e),e.$inject=["Datapoints"]}(),function(){function e(e,t,n){var r=this;return e.model=n,angular.extend(r,t("GenericCreateController",{$scope:e})),r}angular.module("healthcafe.bloodpressure").controller("BloodPressureCreateController",e),e.$inject=["$scope","$controller","BloodPressure"]}(),function(){function e(e,t,n){var r=this;return e.model=n,e.selector=".bodyfat-container",e.chartableProperties="body_fat_percentage",e.chartOptions={measures:{body_fat_percentage:{valueKeyPath:"body.body_fat_percentage.value",range:void 0,units:"%",chart:{pointFillColor:"#4a90e2",pointStrokeColor:"#0066d6"}}}},angular.extend(r,t("GenericChartController",{$scope:e})),r}angular.module("healthcafe.bodyfat").controller("BodyFatController",e),e.$inject=["$scope","$controller","BodyFat"]}(),function(){function e(e){return e.getInstance({namespace:"omh",name:"body-fat-percentage",version:"1.0"},function(e){return e.bodyfat?{body_fat_percentage:{value:e.bodyfat,unit:"%"}}:null})}angular.module("healthcafe.bodyfat").factory("BodyFat",e),e.$inject=["Datapoints"]}(),function(){function e(e,t,n){var r=this;return e.model=n,angular.extend(r,t("GenericCreateController",{$scope:e})),r}angular.module("healthcafe.bodyfat").controller("BodyFatCreateController",e),e.$inject=["$scope","$controller","BodyFat"]}(),function(){function e(e,t,n,r,o,a,c,l,s){var u=this;return u.data={body:{weight:null,height:null,waist:null,bodyfat:null},date:new Date},a.get().then(function(e){u.data.body.height=e.body.body_height.value}),u.save=function(){function r(){n.nextViewOptions({disableBack:!0}),t.go("app.timeline")}var d=[a.set(u.data.body)],h=[];h.push(o),h.push(c),h.push(l),h.push(s);for(i in h)d.push(h[i].create(u.data.body,u.data.date).then(function(e){return h[i].load()})["catch"](function(e){return console.log("Error saving data",h[i].schema,e),e}));console.log("Waiting for saves"),e.all(d).then(function(){r()})["catch"](function(e){r()})},u}angular.module("healthcafe.bodymeasurements").controller("BodyMeasurementsController",e),e.$inject=["$q","$state","$ionicHistory","$ionicPopup","BodyWeight","BodyHeight","BMI","BodyFat","WaistCircumference"]}(),function(){function e(e,t,n){var r=this;return e.model=n,e.selector=".bodyweight-container",e.chartableProperties="body_weight",e.chartOptions={measures:{body_weight:{range:void 0,thresholds:void 0}}},angular.extend(r,t("GenericChartController",{$scope:e})),r}angular.module("healthcafe.bodyweight").controller("BodyWeightController",e),e.$inject=["$scope","$controller","BodyWeight"]}(),function(){function e(e){return e.getInstance({namespace:"omh",name:"body-weight",version:"1.0"},function(e){return e.weight?{body_weight:{value:e.weight,unit:"kg"}}:null})}angular.module("healthcafe.bodyweight").factory("BodyWeight",e),e.$inject=["Datapoints"]}(),function(){function e(e,t,n){var r=this;return e.model=n,angular.extend(r,t("GenericCreateController",{$scope:e})),r}angular.module("healthcafe.bodyweight").controller("BodyWeightCreateController",e),e.$inject=["$scope","$controller","BodyWeight"]}(),function(){function e(e,t,n){var r=this;return e.model=n,e.selector=".cholesterol-container",e.chartableProperties="total-cholesterol,ldl-cholesterol,hdl-cholesterol,triglycerides",e.chartOptions={userInterface:{legend:!0,thresholds:{show:!1},tooltips:{grouped:!1,contentFormatter:function(e){return e.y.toFixed(1)}}},measures:{"total-cholesterol":{valueKeyPath:"body.blood_total_cholesterol.value",range:void 0,seriesName:"Total Cholesterol",units:"mmol/L",chart:{pointFillColor:"#4a90e2",pointStrokeColor:"#0066d6"},thresholds:[{name:"Desirable",max:5},{name:"Borderline high",min:5,max:6.5},{name:"High",min:6.5}]},"ldl-cholesterol":{valueKeyPath:"body.blood_ldl_cholesterol.value",range:{min:0,max:20},seriesName:"LDL Cholesterol",units:"mmol/L",chart:{pointFillColor:"#E24A4A",pointStrokeColor:"#D60000"},thresholds:[{name:"Desirable",max:2.5},{name:"Borderline high",min:2.5,max:3.5},{name:"High",min:3.5}]},"hdl-cholesterol":{valueKeyPath:"body.blood_hdl_cholesterol.value",range:{min:0,max:20},units:"mmol/L",seriesName:"HDL Cholesterol",chart:{pointFillColor:"#4AE250",pointStrokeColor:"#00D605"},thresholds:[{name:"Desirable",min:1.5},{name:"Borderline high",min:1.5,max:1.3},{name:"High",max:1.3}]},triglycerides:{valueKeyPath:"body.blood_triglycerides.value",range:void 0,units:"mmol/L",seriesName:"Triglycerides",chart:{pointFillColor:"#DA4AE2",pointStrokeColor:"#CB00D6"},thresholds:[{name:"Desirable",max:1.7},{name:"Borderline high",min:1.7,max:6},{name:"High",min:6}]}}},angular.extend(r,t("GenericChartController",{$scope:e})),r}angular.module("healthcafe.cholesterol").controller("CholesterolController",e),e.$inject=["$scope","$controller","Cholesterol"]}(),function(){function e(e){return e.getInstance({namespace:"nrc",name:"cholesterol",version:"0.1"},function(e){if(!e.total)return null;var t={blood_total_cholesterol:{value:e.total,unit:"mmol/L"}};return e.ldl&&(t.blood_ldl_cholesterol={value:e.ldl,unit:"mmol/L"}),e.hdl&&(t.blood_hdl_cholesterol={value:e.hdl,unit:"mmol/L"}),e.triglycerides&&(t.blood_triglycerides={value:e.triglycerides,unit:"mmol/L"}),t})}angular.module("healthcafe.cholesterol").factory("Cholesterol",e),e.$inject=["Datapoints"]}(),function(){function e(e,t,n){var r=this;return e.model=n,angular.extend(r,t("GenericCreateController",{$scope:e})),r}angular.module("healthcafe.cholesterol").controller("CholesterolCreateController",e),e.$inject=["$scope","$controller","Cholesterol"]}(),function(){function e(e,t,n){var r=this;return r.data={body:{questionnaire:e.questionnaire,answers:e.defaultValues}},r.save=function(){n.create(r.data.body).then(function(e){t.goBack()})["catch"](function(e){console.log("Error saving data: ",e)})},r}angular.module("healthcafe.generic").controller("GenericAnswerController",e),e.$inject=["$scope","$ionicHistory","Answers"]}(),function(){function e(e,t,n,r,o){function a(e){var n=t.defer(),r=i(e);return o.openStore("answers",function(e){e.insert(r).then(function(e){n.resolve(e)})["catch"](function(e){n.reject(e)})}),n.promise}function i(e){var t={date_time:new Date,questionnaire:e.questionnaire,answers:e.answers};return t}function c(){var e=t.defer();return o.openStore("answers",function(t){t.getAll().then(function(t){e.resolve(t)})["catch"](function(t){e.reject(t)})}),e.promise}function l(e){var n=t.defer();return o.openStore("answers",function(t){t.query();var r=t.query().$index("questionnaire").$eq(e);t.findWhere(r).then(function(e){n.resolve(e)})["catch"](function(e){n.reject(e)})}),n.promise}return this.cache=null,{create:a,list:c,listByQuestionnaire:l}}angular.module("healthcafe.generic").factory("Answers",e),e.$inject=["$http","$q","uuid2","config","$indexedDB"]}(),function(){function e(e,t,n){function r(){function t(e){return e.body.effective_time_frame&&e.body.effective_time_frame.date_time?e.body.effective_time_frame.date_time:e.header.creation_date_time}if(!l.chart){if(!e.events||0==e.events.length)return;e.events.sort(function(e,n){return t(e)-t(n)}),e.events=e.events.map(function(t){return e.model.convertDates(t,function(e){return e.toJSON()})}),o(e.events.slice())}return l.chart}function o(t){l.chart&&l.chart.destroy();var n=d3.select(e.selector);l.chart=new OMHWebVisualizations.Chart(t,n,e.chartableProperties,e.chartOptions)}function a(){var t=d3.select(e.selector),n=r();if(n){var o=t.select("svg");o.style("display","block"),n.renderTo(o.node())}}function i(){e.loading=!0,e.events=[],e.model.list().then(function(t){e.events=t,e.loading=!1,a(t)})}function c(){e.loading=!0,e.events=[],e.model.load().then(function(t){e.events=t,e.loading=!1,a(t)})}var l=this;return l.chart=null,l.remove=function(t){e.model.remove(t).then(function(){c()})},i(),e.$on("$ionicView.enter",function(){t.canDragContent(!1),angular.element(n).bind("resize",a)}),e.$on("$ionicView.leave",function(){t.canDragContent(!0),angular.element(n).unbind("resize",a)}),l}angular.module("healthcafe.generic").controller("GenericChartController",e),e.$inject=["$scope","$ionicSideMenuDelegate","$window"]}(),function(){function e(e,t){var n=this;return n.data={body:"undefined"!=typeof e.model.defaults?e.model.defaults():{},date:new Date},n.save=function(){e.model.create(n.data.body,n.data.date).then(function(n){e.model.load().then(function(){t.goBack()})})["catch"](function(e){console.log("Error saving data: ",e)})},n}angular.module("healthcafe.generic").controller("GenericCreateController",e),e.$inject=["$scope","$ionicHistory"]}(),function(){function e(e,t,n,r,o,a){var i=function(e,t){this.schema=e,this.converter=t,this.cache=null};return i.prototype.load=function(){var e=t.defer(),n=this.schema;return a.openStore("datapoints",function(t){var r=t.query().$index("schema").$eq([n.namespace,n.name,n.version]);t.findWhere(r).then(function(t){e.resolve(t)})["catch"](function(t){e.reject(t)})}),e.promise},i.prototype.list=function(){return this.cache?t.when(this.cache):this.load()},i.prototype.get=function(e){var n=t.defer();return a.openStore("datapoints",function(t){t.find(e).then(function(e){n.resolve(e)})["catch"](function(e){n.reject(e)})}),n.promise},i.prototype.remove=function(e){var n=t.defer();return a.openStore("datapoints",function(t){t["delete"](e).then(function(e){n.resolve(e)})["catch"](function(e){n.reject(e)})}),n.promise},i.prototype.create=function(e,n){if(this.converter&&(e=this.converter(e)),!e)return t.reject("Invalid data specified");var r=t.defer(),o=this.createDatapoint(e,n);this.schema;return a.openStore("datapoints",function(e){e.insert(o).then(function(e){r.resolve(e)})["catch"](function(e){r.reject(e)})}),r.promise},i.prototype["import"]=function(e){function n(e){return e&&"string"==typeof e?new Date(e):e}var r=t.defer();if(Array.isArray(e)){var o=this;e=e.map(function(e){return o.convertDates(e,n)})}else"object"==typeof e&&(e=this.convertDates(e,n));return a.openStore("datapoints",function(t){t.upsert(e).then(function(e){r.resolve(e)})["catch"](function(e){r.reject(e)})}),r.promise},i.prototype.convertDates=function(e,t){return e.header&&e.header.creation_date_time&&(e.header.creation_date_time=t(e.header.creation_date_time)),e.header&&e.header.acquisition_provenance&&e.header.acquisition_provenance.source_creation_date_time&&(e.header.acquisition_provenance.source_creation_date_time=t(e.header.acquisition_provenance.source_creation_date_time)),e.body&&e.body.effective_time_frame&&e.body.effective_time_frame.date_time&&(e.body.effective_time_frame.date_time=t(e.body.effective_time_frame.date_time)),e},i.prototype.defaults=function(){return{}},i.prototype.chartableProperties=function(){return this.propertyNames},i.prototype.createDatapoint=function(e,t){return"undefined"==typeof t&&(t=new Date),e.effective_time_frame={date_time:t},{header:{id:n.newuuid(),creation_date_time:new Date,acquisition_provenance:{source_name:"Manual",source_creation_date_time:new Date,modality:"self-reported"},schema_id:this.schema},body:e}},{getInstance:function(e,t){return new i(e,t)}}}angular.module("healthcafe.generic").factory("Datapoints",e),e.$inject=["$http","$q","uuid2","OAuth2","config","$indexedDB"]}(),function(){function e(e,t,n){var r=this;r.measurementId=t.params.measurementId,r.measurement=null;var o=n.getInstance();return o.get(r.measurementId).then(function(e){r.measurement=e,e.body.effective_time_frame&&e.body.effective_time_frame.date_time?date=e.body.effective_time_frame.date_time:date=e.header.creation_date_time,r.date=date})["catch"](function(e){console.log("Error loading data: ",e)}),r}angular.module("healthcafe.generic").controller("GenericDetailController",e),e.$inject=["$scope","$state","Datapoints"]}(),function(){function e(){var e=this;return e}angular.module("healthcafe.generic").controller("GenericInfoController",e)}(),function(){function e(e,t,n,r,o,a){var i=function(e,t){this.schema=e,this.converter=t,this.cache=null};return i.prototype.load=function(){var e=t.defer(),n=this.schema;return a.openStore("datapoints",function(t){var r=t.query().$index("schema").$eq([n.namespace,n.name,n.version]);t.findWhere(r).then(function(t){this.cache=t,e.resolve(t)})["catch"](function(t){e.reject(t)})}),e.promise},i.prototype.list=function(){return this.cache?t.when(this.cache):this.load()},i.prototype.get=function(){var e=t.defer();return this.list().then(function(t){t.length>0?e.resolve(t[0]):e.reject("No datapoints available")})["catch"](function(t){e.reject(t)}),e.promise},i.prototype.remove=function(){var e=t.defer();return this.get().then(function(t){a.openStore("datapoints",function(n){n["delete"](t.header.id).then(function(t){e.resolve()})["catch"](function(t){e.reject(t)})})})["catch"](function(t){e.resolve()}),e.promise},i.prototype.set=function(e,n){function r(){var t=i.createDatapoint(e,n);i.remove().then(function(){this.schema;a.openStore("datapoints",function(e){e.insert(t).then(function(e){o.resolve(e)})["catch"](function(e){o.reject(e)})})})["catch"](function(e){o.reject(e)})}if(this.converter&&(e=this.converter(e)),"undefined"==typeof n&&(n=new Date),!e)return t.reject("Invalid data specified");var o=t.defer();this.get().then(function(t){var n=angular.copy(t.body);delete n.effective_time_frame,JSON.stringify(n)!=JSON.stringify(e)?r():o.resolve(t)})["catch"](function(){r()});var i=this;return o.promise},i.prototype["import"]=function(e){function n(e){return e&&"string"==typeof e?new Date(e):e}var r=t.defer();return Array.isArray(e)?e=this.convertDates(e[0],n):"object"==typeof e&&(e=this.convertDates(e,n)),a.openStore("datapoints",function(t){t.upsert(e).then(function(e){r.resolve(e)})["catch"](function(e){r.reject(e)})}),r.promise},i.prototype.convertDates=function(e,t){return e.header&&e.header.creation_date_time&&(e.header.creation_date_time=t(e.header.creation_date_time)),e.header&&e.header.acquisition_provenance&&e.header.acquisition_provenance.source_creation_date_time&&(e.header.acquisition_provenance.source_creation_date_time=t(e.header.acquisition_provenance.source_creation_date_time)),e.body&&e.body.effective_time_frame&&e.body.effective_time_frame.date_time&&(e.body.effective_time_frame.date_time=t(e.body.effective_time_frame.date_time)),e},i.prototype.createDatapoint=function(e,t){return"undefined"==typeof t&&(t=new Date),e.effective_time_frame={date_time:t},{header:{id:n.newuuid(),creation_date_time:new Date,acquisition_provenance:{source_name:"Manual",source_creation_date_time:new Date,modality:"self-reported"},schema_id:this.schema},body:e}},{getInstance:function(e,t){return new i(e,t)}}}angular.module("healthcafe.generic").factory("StaticDatapoint",e),e.$inject=["$http","$q","uuid2","OAuth2","config","$indexedDB"]}(),function(){function e(e,t,n,r,o){var a=this;return a.resetNav=function(){t.nextViewOptions({disableBack:!0})},a.personal_data_required=!0,n.get().then(function(){a.personal_data_required=!1}),r.get().then(function(){a.personal_data_required=!1}),o.get().then(function(){a.personal_data_required=!1}),this}angular.module("healthcafe.intro").controller("IntroController",e),e.$inject=["$scope","$ionicHistory","BodyHeight","Gender","DateOfBirth"]}(),function(){function e(e){function t(e){var t=window.localStorage.getItem("token-"+e);return t?JSON.parse(t):null}function n(e){return!!t(e)}function r(e){var n=t(e);return n?n.oauth.access_token:null}function o(t,n){window.localStorage.setItem("redirect-"+t,n);var r=e.current().api,o=r.oauth[t],a=o.urls;url=a.authorization+"?client_id="+o.key+"&redirect_uri="+encodeURIComponent(a.redirect)+"&response_type=token&scope=read_data_points write_data_points delete_data_points",window.location.href=url}function a(e){window.localStorage.removeItem("token-"+e)}return{isAuthenticated:n,getAccessToken:r,login:o,logoff:a}}angular.module("healthcafe.login").factory("OAuth2",e),e.$inject=["config"]}(),function(){function e(e,t,n){function r(t){return t.oauth&&(t.headers.Authorization="Bearer "+e.getAccessToken(t.oauth)),t}function o(e){var r=e.config||{};if(!r.ignoreAuthModule)switch(e.status){case 401:t.$broadcast("event:auth-unauthorized",e);break;case 403:t.$broadcast("event:auth-forbidden",e)}return n.reject(e)}return{request:r,responseError:o}}angular.module("healthcafe.login").factory("OAuth2Interceptor",e),e.$inject=["OAuth2","$rootScope","$q"]}(),function(){function e(e){return e.getInstance({namespace:"omh",name:"body-height",version:"1.0"},function(e){return e.height?{body_height:{value:e.height,unit:"kg"}}:null})}angular.module("healthcafe.personal").factory("BodyHeight",e),e.$inject=["StaticDatapoint"]}(),function(){function e(e){return e.getInstance({namespace:"nrc",name:"date-of-birth",version:"0.1"},function(e){return e.dob?{date_of_birth:e.dob}:null})}angular.module("healthcafe.personal").factory("DateOfBirth",e),e.$inject=["StaticDatapoint"]}(),function(){function e(e){return e.getInstance({namespace:"nrc",name:"gender",version:"0.1"},function(e){return e.gender?{gender:e.gender}:null})}angular.module("healthcafe.personal").factory("Gender",e),e.$inject=["StaticDatapoint"]}(),function(){function e(e,t,n,r,o,a){var i=this;return i.data={body:{dob:null,gender:null,height:null},date:new Date},r.get().then(function(e){i.data.body.dob=e.body.date_of_birth}),o.get().then(function(e){i.data.body.gender=e.body.gender}),a.get().then(function(e){i.data.body.height=e.body.body_height.value}),i.save=function(){function c(){r.load(),o.load(),a.load()}function l(){n.nextViewOptions({disableBack:!0}),t.go("app.timeline")}var s=[r.set(i.data.body),o.set(i.data.body),a.set(i.data.body)];e.all(s).then(function(){c(),l()})["catch"](function(e){c(),l()})},i}angular.module("healthcafe.personal").controller("PersonalController",e),e.$inject=["$q","$state","$ionicHistory","DateOfBirth","Gender","BodyHeight"]}(),function(){function e(e){function t(){r.remarks=[],e.list().then(function(e){r.remarks=e})}function n(){r.remarks=[],e.load().then(function(e){r.remarks=e})}var r=this;return r.remove=function(t){e.remove(t).then(function(){n()})},t(),r}angular.module("healthcafe.remarks").controller("RemarksController",e),e.$inject=["Remarks"]}(),function(){function e(e,t){function n(){var n=e.defer();return t.openStore("remarks",function(e){e.getAll().then(function(e){n.resolve(e)})["catch"](function(e){n.reject(e)})}),n.promise}function r(){return c?e.when(c):n()}function o(n){var r=e.defer();return t.openStore("remarks",function(e){e.get(n).then(function(e){r.resolve(e)})["catch"](function(e){r.reject(e)})}),r.promise}function a(n){var r=e.defer();return t.openStore("remarks",function(e){e["delete"](n).then(function(e){r.resolve(e)})["catch"](function(e){r.reject(e)})}),r.promise}function i(n){var r=e.defer();return t.openStore("remarks",function(e){e.insert(n).then(function(e){r.resolve(e)})["catch"](function(e){r.reject(e)})}),r.promise}var c=null;return{create:i,load:n,list:r,remove:a,get:o,defaults:function(){return{date:new Date}}}}angular.module("healthcafe.remarks").factory("Remarks",e),e.$inject=["$q","$indexedDB"]}(),function(){function e(e,t,n){var r=this;return e.model=n,angular.extend(r,t("GenericCreateController",{$scope:e})),r}angular.module("healthcafe.remarks").controller("RemarksCreateController",e),e.$inject=["$scope","$controller","Remarks"]}(),function(){function e(e,t,n){var r=this,o=e.params.service;return t.isAuthenticated(o)?void e.go("app.share",{service:o}):(r.serviceKey=o,r.service=n.sharing[o],r.login=function(){t.login(o,"/app/share/"+o)},r)}angular.module("healthcafe.sharing").controller("ConnectController",e),e.$inject=["$state","OAuth2","config"]}(),function(){function e(e,t,n,r,o,a){var c=this,l=e.params.service;if(!r.isAuthenticated(l))return t.nextViewOptions({disableBack:!0}),void e.go("app.connect",{service:l});c.serviceKey=l,c.service=o.sharing[l];var s=o.datatypes.slice();for(i in s)s[i].checked=!0;return c.datatypes=s,c.importing=!1,c["import"]=function(){c.importing=!0,a.pull(l,c.datatypes).then(function(t){c.importing=!1;var r=t.reduce(function(e,t){return e+(t?t.length:0)},0);n.alert({title:"Import succeeded",template:""+r+" data point(s) have been imported into your app."}).then(function(t){e.go("app.timeline")})})["catch"](function(t){c.importing=!1,401==t.status?n.alert({title:"Credentials expired",template:"Unfortunately your credentials have expired. Please allow the application access."}).then(function(t){r.logoff(l),e.go("app.connect",{service:l})}):n.alert({title:"Sharing error",template:"An error occurred while importing data from "+c.service.label+". Please contact an administrator.<br /><br />"+t.status+": "+t.data.error})})},c.exporting=!1,c["export"]=function(){c.exporting=!0,a.push(l,c.datatypes).then(function(t){c.exporting=!1;var r=t.reduce(function(e,t){return e+(t?t.length:0)},0);n.alert({title:"Share succeeded",template:""+r+" data point(s) have been shared with "+c.service.label+"."}).then(function(t){e.go("app.timeline")})})["catch"](function(t){c.exporting=!1,401==t.status?n.alert({title:"Credentials expired",template:"Unfortunately your credentials have expired. Please allow the application access."}).then(function(t){r.logoff(l),e.go("app.connect",{service:l})}):n.alert({title:"Sharing error",template:"An error occurred while sharing data with "+c.service.label+". Please contact an administrator.<br /><br />"+t.status+": "+t.data.error})})},c}angular.module("healthcafe.sharing").controller("ShareController",e),e.$inject=["$state","$ionicHistory","$ionicPopup","OAuth2","config","Share"]}(),function(){function e(e,t,n,r,o,a,i,c,l){function s(e,n){var o=r.sharing[e],a=d(n);if(!o)return console.error("Importing data from invalid service",e),t.reject("Importing data from invalid service");switch(o.type){case"openmhealth":return h(e,a);default:return console.error("Service type for given service is not supported",e,o.type),t.reject("Service type for given service is not supported")}}function u(e,n){var o=r.sharing[e],a=d(n);if(!o)return console.error("Exporting data to invalid service",e),t.reject("Exporting data to invalid service");switch(o.type){case"openmhealth":return f(e,a);default:return console.error("Service type for given service is not supported",e,o.type),t.reject("Service type for given service is not supported")}}function d(e){return e.filter(function(e){return e.checked}).map(function(e){switch(e.name){case"bloodpressure":return o;case"bloodglucose":return c;case"bodyweight":return a;case"cholesterol":return l;case"bmi":return i;default:return console.error("Invalid datatype selected",e.name),null}})}function h(e,o){var a=r.current().api.oauth[e];return a?t.all(o.map(function(t){var r=a.urls.dataPoints+"?schema_namespace="+encodeURIComponent(t.schema.namespace)+"&schema_name="+encodeURIComponent(t.schema.name)+"&schema_version="+encodeURIComponent(t.schema.version);return n.get(r,{oauth:e}).then(function(e){return t["import"](e.data)})})):(console.error("OAuth parameters for given service are not provided in configuration",e),
t.reject("OAuth parameters for given service are not provided in configuration"))}function f(e,o){var a=r.current().api.oauth[e];return a?t.all(o.map(function(r){return r.list().then(function(o){var i=a.urls.dataPoints;return t.all(o.map(function(o){function a(e){return"object"==typeof e?e.toJSON():e}o=r.convertDates(o,a);var c=t.defer();return n.post(i,o,{oauth:e}).then(function(e){c.resolve(e)})["catch"](function(e){409==e.status?c.resolve(e):c.reject(e)}),c.promise}))})})):(console.error("OAuth parameters for given service are not provided in configuration",e),t.reject("OAuth parameters for given service are not provided in configuration"))}return{pull:s,push:u}}angular.module("healthcafe.sharing").factory("Share",e),e.$inject=["$indexedDB","$q","$http","config","BloodPressure","BodyWeight","BMI","BloodGlucose","Cholesterol"]}(),function(){function e(e,t,n,r,o,a,i,c,l,s,u,d){function h(e){e.body.effective_time_frame&&e.body.effective_time_frame.date_time?date=e.body.effective_time_frame.date_time:date=e.header.creation_date_time;var t=e.header.schema_id.name;return{id:e.header.id,datapoint:e,date:date,badgeIconClass:y[t].icon,badgeClass:e.header.schema_id.name,type:"measurement",measurementType:t,model:y[t].model,showDetail:function(){var n;switch(t){case"body-mass-index":n="bmi";break;case"body-fat-percentage":n="bodyfat";break;default:n=t.replace(/-/g,"")}d.go("app."+n+"_measurement",{measurementId:e.header.id})}}}function f(e){return angular.extend({},e,{badgeIconClass:"ion-flash",badgeClass:"remark",type:"intervention",model:c,showDetail:function(){return!1}})}function m(e){var t=p(e.map(function(e){return e.map(function(e){return e.header&&e.body?h(e):f(e)})}));return t.sort(function(e,t){return new Date(t.date)-new Date(e.date)})}function p(e){return[].concat.apply([],e)}function g(e){v.loading=!0,v.events=[],l.all(e.map(function(e){return e.list()})).then(function(e){v.events=m(e)}).then(function(){v.loading=!1})}var v=this,y={"blood-glucose":{icon:"ion-fork",model:e},"blood-pressure":{icon:"ion-heart",model:t},"body-mass-index":{icon:"ion-ios-flame",model:n},"body-fat-percentage":{icon:"ion-pie-graph",model:r},"body-weight":{icon:"ion-speedometer",model:o},cholesterol:{icon:"ion-waterdrop",model:a},"waist-circumference":{icon:"ion-ios-circle-outline",model:i}};return v.load=function(){var l=[e,t,n,r,o,a,i,c];g(l)},v.load(),v.remove=function(e){return confirm("Are you sure?")&&e.model.remove(e.id).then(function(){return e.removed=!0,u(function(){},200)}).then(function(){return e.model.load()}).then(function(){return v.load()}),!1},s.fromTemplateUrl("app/timeline/add_menu.html").then(function(e){v.popover=e}),v}angular.module("healthcafe.timeline").controller("TimelineController",e),e.$inject=["BloodGlucose","BloodPressure","BMI","BodyFat","BodyWeight","Cholesterol","WaistCircumference","Remarks","$q","$ionicPopover","$timeout","$state"]}(),function(){function e(e,t,n){var r=this;return r.data=[],n.list().then(function(e){r.all=e}),r.test=[],n.listByQuestionnaire("vita16").then(function(e){r.vita16=e}),e.selector=".vita16-container",r}angular.module("healthcafe.vita16").controller("Vita16Controller",e),e.$inject=["$scope","$controller","Answers"]}(),function(){function e(e,t){var n=this,r={q01:4,q02:4,q03:4,q04:4,q05:4,q06:4,q07:4,q08:4,q09:4,q10:4,q11:4,q12:4,q13:4,q14:4,q15:4,q16:4,q17:4};return e.questionnaire="vita16",e.defaultValues=r,angular.extend(n,t("GenericAnswerController",{$scope:e})),n}angular.module("healthcafe.vita16").controller("Vita16AnswerController",e),e.$inject=["$scope","$controller"]}(),function(){function e(e,t,n){var r=this;return e.model=n,e.selector=".waist-container",e.chartableProperties="waist_circumference",e.chartOptions={measures:{waist_circumference:{valueKeyPath:"body.waist_circumference.value",range:void 0,units:"m",chart:{pointFillColor:"#4a90e2",pointStrokeColor:"#0066d6"}}}},angular.extend(r,t("GenericChartController",{$scope:e})),r}angular.module("healthcafe.waistcircumference").controller("WaistCircumferenceController",e),e.$inject=["$scope","$controller","WaistCircumference"]}(),function(){function e(e){return e.getInstance({namespace:"nrc",name:"waist-circumference",version:"0.1"},function(e){return e.waist?{waist_circumference:{value:e.waist,unit:"m"}}:null})}angular.module("healthcafe.waistcircumference").factory("WaistCircumference",e),e.$inject=["Datapoints"]}(),function(){function e(e,t,n){var r=this;return e.model=n,angular.extend(r,t("GenericCreateController",{$scope:e})),r}angular.module("healthcafe.waistcircumference").controller("WaistCircumferenceCreateController",e),e.$inject=["$scope","$controller","WaistCircumference"]}();