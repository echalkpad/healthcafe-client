!function(){var e=["healthcafe.generic","healthcafe.intro","healthcafe.login","healthcafe.bloodpressure","healthcafe.bodyweight","healthcafe.bmi","healthcafe.bloodglucose","healthcafe.cholesterol","healthcafe.timeline","healthcafe.remarks","healthcafe.sharing"];angular.module("healthcafe",["ionic","ngMessages","angularUUID2","angular-timeline","indexedDB"].concat(e)).run(["$ionicPlatform",function(e){e.ready(function(){window.cordova&&window.cordova.plugins&&window.cordova.plugins.Keyboard&&(cordova.plugins.Keyboard.hideKeyboardAccessoryBar(!0),cordova.plugins.Keyboard.disableScroll(!0)),window.StatusBar&&StatusBar.styleDefault()})}]);for(idx in e)angular.module(e[idx],[])}(),function(){var e={env:"dev",sharing:{healthcafe:{label:"NRC healthcafe",description:"Healthcafe is een concept, een werk-in-uitvoering, waar u binnnen de werkomgeving zelf bepaalde aspecten van uw gezondheid kan meten en daarop zelf kan acteren.",type:"openmhealth"}},datatypes:[{name:"bloodpressure",controllerPrefix:"BloodPressure",label:"Blood pressure"},{name:"bodyweight",controllerPrefix:"BodyWeight",label:"Body weight"},{name:"bmi",controllerPrefix:"BMI",label:"Body Mass Index"},{name:"bloodglucose",controllerPrefix:"BloodGlucose",label:"Blood Glucose"},{name:"cholesterol",controllerPrefix:"Cholesterol",label:"Cholesterol"}],dev:{api:{oauth:{healthcafe:{urls:{authorization:"http://localhost:8080/nrc/oauth/authorize",redirect:"http://localhost:8100/app/login/oauth_callback.html?healthcafe",dataPoints:"http://localhost:8080/nrc/api/openmhealth/v1/dataPoints"},key:"mbm85kztfalztd2fft5fl5w7hmmdar5nnlktkgkk"}}}},test:{api:{oauth:{healthcafe:{urls:{authorization:"https://humanstudies.tno.nl/healthcafe/oauth/authorize",redirect:"http://isdatsoftwareontwikkeling.nl/projecten/healthcafe/app/login/oauth_callback.html?healthcafe",dataPoints:"https://humanstudies.tno.nl/healthcafe/api/openmhealth/v1/dataPoints"},key:"hm2lkbxyssh9vvsn4tjpknavhqifmkzmucrl500o"}}}}};e.current=function(){return e[e.env]},angular.module("healthcafe").constant("config",e).config(["$httpProvider","$indexedDBProvider",function(e,t){e.interceptors.push("OAuth2Interceptor"),t.connection("healthcafe").upgradeDatabase(1,function(e,t,n){datapointsStore=t.createObjectStore("datapoints",{keyPath:"header.id"}),datapointsStore.createIndex("schema",["header.schema_id.namespace","header.schema_id.name","header.schema_id.version"],{unique:!1}),remarksStore=t.createObjectStore("remarks",{keyPath:"id",autoIncrement:!0})})}])}(),function(){angular.module("healthcafe").config(["$stateProvider","$urlRouterProvider","config",function(e,t,n){e.state("app",{url:"/app","abstract":!0,templateUrl:"app/layout.html",controller:"AppController as app"}).state("app.intro",{url:"/intro",views:{mainContent:{templateUrl:"app/intro/intro.html",controller:"IntroController as intro"}}}).state("app.timeline",{url:"/timeline",cache:!1,views:{mainContent:{templateUrl:"app/timeline/timeline.html",controller:"TimelineController as timeline"}}});for(i in n.datatypes){var o=n.datatypes[i];e.state("app."+o.name,{url:"/"+o.name,cache:!1,views:{mainContent:{templateUrl:"app/"+o.name+"/chart.html",controller:o.controllerPrefix+"Controller as "+o.name}}}).state("app."+o.name+"_add",{url:"/"+o.name+"/add",views:{mainContent:{templateUrl:"app/"+o.name+"/create.html",controller:o.controllerPrefix+"CreateController as "+o.name}}}).state("app."+o.name+"_info",{url:"/"+o.name+"/info",views:{mainContent:{templateUrl:"app/"+o.name+"/info.html",controller:"GenericInfoController as info"}}}).state("app."+o.name+"_measurement",{url:"/"+o.name+"/detail/:measurementId",views:{mainContent:{templateUrl:"app/"+o.name+"/detail.html",controller:"GenericDetailController as detail"}}})}e.state("app.remarks_add",{url:"/remarks/add",views:{mainContent:{templateUrl:"app/remarks/create.html",controller:"RemarksCreateController as remarks"}}}),e.state("app.share",{url:"/share/:service",cache:!1,views:{mainContent:{templateUrl:"app/share/share.html",controller:"ShareController as sharing"}}}),e.state("app.connect",{url:"/share/connect/:service",cache:!1,views:{mainContent:{templateUrl:"app/share/connect.html",controller:"ConnectController as connect"}}}),t.otherwise("/app/intro")}])}(),function(){function e(e){var t=this;return t.datatypes=e.datatypes,t.sharing=e.sharing,t}angular.module("healthcafe").controller("AppController",e),e.$inject=["config"]}(),function(){function e(e,t,n){var o=this;return e.model=n,e.selector=".bloodglucose-container",e.chartableProperties="blood-glucose",e.chartOptions={measures:{"blood-glucose":{valueKeyPath:"body.blood_glucose.value",range:void 0,units:"mg/dL"}}},angular.extend(o,t("GenericChartController",{$scope:e})),o}angular.module("healthcafe.bloodglucose").controller("BloodGlucoseController",e),e.$inject=["$scope","$controller","BloodGlucose"]}(),function(){function e(e){return e.getInstance({namespace:"omh",name:"blood-glucose",version:"1.0"},function(e){return e.level?{blood_glucose:{value:e.level,unit:"mmHg"},temporal_relationship_to_meal:e.relationship_to_meal?e.relationship_to_meal.name:""}:null})}angular.module("healthcafe.bloodglucose").factory("BloodGlucose",e),e.$inject=["Datapoints"]}(),function(){function e(e,t,n){var o=this;return e.model=n,angular.extend(o,t("GenericCreateController",{$scope:e})),o.relationships_to_meal=[{name:"fasting"},{name:"not fasting"}],o}angular.module("healthcafe.bloodglucose").controller("BloodGlucoseCreateController",e),e.$inject=["$scope","$controller","BloodGlucose"]}(),function(){function e(e,t,n){var o=this;return e.model=n,e.selector=".bodyweight-container",e.chartableProperties="body_weight",e.chartOptions={measures:{body_weight:{range:void 0,thresholds:void 0}}},angular.extend(o,t("GenericChartController",{$scope:e})),o}angular.module("healthcafe.bodyweight").controller("BodyWeightController",e),e.$inject=["$scope","$controller","BodyWeight"]}(),function(){function e(e){return e.getInstance({namespace:"omh",name:"body-weight",version:"1.0"},function(e){return e.weight?{body_weight:{value:e.weight,unit:"kg"}}:null})}angular.module("healthcafe.bodyweight").factory("BodyWeight",e),e.$inject=["Datapoints"]}(),function(){function e(e,t,n){var o=this;return e.model=n,angular.extend(o,t("GenericCreateController",{$scope:e})),o}angular.module("healthcafe.bodyweight").controller("BodyWeightCreateController",e),e.$inject=["$scope","$controller","BodyWeight"]}(),function(){function e(e,t,n){var o=this;return e.model=n,e.selector=".bmi-container",e.chartableProperties="body-mass-index",e.chartOptions={measures:{"body-mass-index":{valueKeyPath:"body.body_mass_index.value",range:void 0,units:"kg/m2",thresholds:{min:18,max:25}}}},angular.extend(o,t("GenericChartController",{$scope:e})),o}angular.module("healthcafe.bmi").controller("BMIController",e),e.$inject=["$scope","$controller","BMI"]}(),function(){function e(e){return e.getInstance({namespace:"omh",name:"body-mass-index",version:"1.0"},function(e){return e.weight&&e.length?{body_mass_index:{value:e.weight/(e.length*e.length),unit:"kg/m2"}}:null})}angular.module("healthcafe.bmi").factory("BMI",e),e.$inject=["Datapoints"]}(),function(){function e(e,t,n){var o=this;return e.model=n,angular.extend(o,t("GenericCreateController",{$scope:e})),o}angular.module("healthcafe.bmi").controller("BMICreateController",e),e.$inject=["$scope","$controller","BMI"]}(),function(){function e(e,t,n){var o=this;return e.model=n,e.selector=".cholesterol-container",e.chartableProperties="total-cholesterol,ldl-cholesterol,hdl-cholesterol,triglycerides",e.chartOptions={userInterface:{legend:!0,thresholds:{show:!1},tooltips:{grouped:!1,contentFormatter:function(e){return e.y.toFixed(1)}}},measures:{"total-cholesterol":{valueKeyPath:"body.blood_total_cholesterol.value",range:void 0,seriesName:"Total Cholesterol",units:"mg/dL",chart:{pointFillColor:"#4a90e2",pointStrokeColor:"#0066d6"},thresholds:[{name:"Desirable",max:200},{name:"Borderline high",min:200,max:240},{name:"High",min:240}]},"ldl-cholesterol":{valueKeyPath:"body.blood_ldl_cholesterol.value",range:{min:0,max:20},seriesName:"LDL Cholesterol",units:"mg/dL",chart:{pointFillColor:"#E24A4A",pointStrokeColor:"#D60000"}},"hdl-cholesterol":{valueKeyPath:"body.blood_hdl_cholesterol.value",range:{min:0,max:20},units:"mg/dL",seriesName:"HDL Cholesterol",chart:{pointFillColor:"#4AE250",pointStrokeColor:"#00D605"}},triglycerides:{valueKeyPath:"body.blood_triglycerides.value",range:void 0,units:"mg/dL",seriesName:"Triglycerides",chart:{pointFillColor:"#DA4AE2",pointStrokeColor:"#CB00D6"}}}},angular.extend(o,t("GenericChartController",{$scope:e})),o}angular.module("healthcafe.cholesterol").controller("CholesterolController",e),e.$inject=["$scope","$controller","Cholesterol"]}(),function(){function e(e){return e.getInstance({namespace:"nrc",name:"cholesterol",version:"0.1"},function(e){if(!e.total)return null;var t={blood_total_cholesterol:{value:e.total,unit:"mg/dL"}};return e.ldl&&(t.blood_ldl_cholesterol={value:e.ldl,unit:"mg/dL"}),e.hdl&&(t.blood_hdl_cholesterol={value:e.hdl,unit:"mg/dL"}),e.triglycerides&&(t.blood_triglycerides={value:e.triglycerides,unit:"mg/dL"}),t})}angular.module("healthcafe.cholesterol").factory("Cholesterol",e),e.$inject=["Datapoints"]}(),function(){function e(e,t,n){var o=this;return e.model=n,angular.extend(o,t("GenericCreateController",{$scope:e})),o}angular.module("healthcafe.cholesterol").controller("CholesterolCreateController",e),e.$inject=["$scope","$controller","Cholesterol"]}(),function(){function e(e,t,n){var o=this;return e.model=n,e.selector=".bloodpressure-container",e.chartableProperties="systolic_blood_pressure, diastolic_blood_pressure",e.chartOptions={userInterface:{tooltips:{contentFormatter:function(e){var t=e.omhDatum.body.systolic_blood_pressure.value.toFixed(0),n=e.omhDatum.body.diastolic_blood_pressure.value.toFixed(0);return t+"/"+n}}}},angular.extend(o,t("GenericChartController",{$scope:e})),o}angular.module("healthcafe.bloodpressure").controller("BloodPressureController",e),e.$inject=["$scope","$controller","BloodPressure"]}(),function(){function e(e){return e.getInstance({namespace:"omh",name:"blood-pressure",version:"1.0"},function(e){return e.systolic&&e.diastolic?{systolic_blood_pressure:{value:e.systolic,unit:"mmHg"},diastolic_blood_pressure:{value:e.diastolic,unit:"mmHg"}}:null})}angular.module("healthcafe.bloodpressure").factory("BloodPressure",e),e.$inject=["Datapoints"]}(),function(){function e(e,t,n){var o=this;return e.model=n,angular.extend(o,t("GenericCreateController",{$scope:e})),o}angular.module("healthcafe.bloodpressure").controller("BloodPressureCreateController",e),e.$inject=["$scope","$controller","BloodPressure"]}(),function(){function e(e,t,n){function o(){function t(e){return e.body.effective_time_frame&&e.body.effective_time_frame.date_time?e.body.effective_time_frame.date_time:e.header.creation_date_time}if(!c.chart){if(!e.events||0==e.events.length)return;e.events.sort(function(e,n){return t(e)-t(n)}),e.events=e.events.map(function(t){return e.model.convertDates(t,function(e){return e.toJSON()})}),r(e.events.slice())}return c.chart}function r(t){c.chart&&c.chart.destroy();var n=d3.select(e.selector);c.chart=new OMHWebVisualizations.Chart(t,n,e.chartableProperties,e.chartOptions)}function a(){var t=d3.select(e.selector),n=o();if(n){var r=t.select("svg");r.style("display","block"),n.renderTo(r.node())}}function i(){e.loading=!0,e.events=[],e.model.list().then(function(t){e.events=t,e.loading=!1,a(t)})}function l(){e.loading=!0,e.events=[],e.model.load().then(function(t){e.events=t,e.loading=!1,a(t)})}var c=this;return c.chart=null,c.remove=function(t){e.model.remove(t).then(function(){l()})},i(),e.$on("$ionicView.enter",function(){t.canDragContent(!1),angular.element(n).bind("resize",a)}),e.$on("$ionicView.leave",function(){t.canDragContent(!0),angular.element(n).unbind("resize",a)}),c}angular.module("healthcafe.generic").controller("GenericChartController",e),e.$inject=["$scope","$ionicSideMenuDelegate","$window"]}(),function(){function e(e,t){var n=this;return n.data="undefined"!=typeof e.model.defaults?e.model.defaults():{},n.save=function(){e.model.create(n.data).then(function(n){e.model.load().then(function(){t.goBack()})})["catch"](function(e){console.log("Error saving data: ",e)})},n}angular.module("healthcafe.generic").controller("GenericCreateController",e),e.$inject=["$scope","$ionicHistory"]}(),function(){function e(e,t,n,o,r,a){var i=function(e,t){this.schema=e,this.converter=t,this.cache=null};return i.prototype.load=function(){var e=t.defer(),n=this.schema;return a.openStore("datapoints",function(t){var o=t.query().$index("schema").$eq([n.namespace,n.name,n.version]);t.findWhere(o).then(function(t){e.resolve(t)})["catch"](function(t){e.reject(t)})}),e.promise},i.prototype.list=function(){return this.cache?t.when(this.cache):this.load()},i.prototype.get=function(e){var n=t.defer();return a.openStore("datapoints",function(t){t.find(e).then(function(e){n.resolve(e)})["catch"](function(e){n.reject(e)})}),n.promise},i.prototype.remove=function(e){var n=t.defer();return a.openStore("datapoints",function(t){t["delete"](e).then(function(e){n.resolve(e)})["catch"](function(e){n.reject(e)})}),n.promise},i.prototype.create=function(e){if(this.converter&&(e=this.converter(e)),!e)return t.reject("Invalid data specified");var n=t.defer(),o=this.createDatapoint(e);this.schema;return a.openStore("datapoints",function(e){e.insert(o).then(function(e){n.resolve(e)})["catch"](function(e){n.reject(e)})}),n.promise},i.prototype["import"]=function(e){function n(e){return e&&"string"==typeof e?new Date(e):e}var o=t.defer();if(Array.isArray(e)){var r=this;e=e.map(function(e){return r.convertDates(e,n)})}else"object"==typeof e&&(e=this.convertDates(e,n));return a.openStore("datapoints",function(t){t.upsert(e).then(function(e){o.resolve(e)})["catch"](function(e){o.reject(e)})}),o.promise},i.prototype.convertDates=function(e,t){return e.header&&e.header.creation_date_time&&(e.header.creation_date_time=t(e.header.creation_date_time)),e.header&&e.header.acquisition_provenance&&e.header.acquisition_provenance.source_creation_date_time&&(e.header.acquisition_provenance.source_creation_date_time=t(e.header.acquisition_provenance.source_creation_date_time)),e.body&&e.body.effective_time_frame&&e.body.effective_time_frame.date_time&&(e.body.effective_time_frame.date_time=t(e.body.effective_time_frame.date_time)),e},i.prototype.defaults=function(){return{}},i.prototype.chartableProperties=function(){return this.propertyNames},i.prototype.createDatapoint=function(e){return e.effective_time_frame={date_time:new Date},{header:{id:n.newuuid(),creation_date_time:new Date,acquisition_provenance:{source_name:"Manual",source_creation_date_time:new Date,modality:"self-reported"},schema_id:this.schema},body:e}},{getInstance:function(e,t){return new i(e,t)}}}angular.module("healthcafe.generic").factory("Datapoints",e),e.$inject=["$http","$q","uuid2","OAuth2","config","$indexedDB"]}(),function(){function e(e,t,n){var o=this;o.measurementId=t.params.measurementId,o.measurement=null;var r=n.getInstance();return r.get(o.measurementId).then(function(e){o.measurement=e,e.body.effective_time_frame&&e.body.effective_time_frame.date_time?date=e.body.effective_time_frame.date_time:date=e.header.creation_date_time,o.date=date})["catch"](function(e){console.log("Error loading data: ",e)}),o}angular.module("healthcafe.generic").controller("GenericDetailController",e),e.$inject=["$scope","$state","Datapoints"]}(),function(){function e(){var e=this;return e}angular.module("healthcafe.generic").controller("GenericInfoController",e)}(),function(){function e(e,t){var n=this;return n.resetNav=function(){t.nextViewOptions({disableBack:!0})},this}angular.module("healthcafe.intro").controller("IntroController",e),e.$inject=["$scope","$ionicHistory"]}(),function(){function e(e){function t(e){var t=window.localStorage.getItem("token-"+e);return t?JSON.parse(t):null}function n(e){return!!t(e)}function o(e){var n=t(e);return n?n.oauth.access_token:null}function r(t,n){window.localStorage.setItem("redirect-"+t,n);var o=e.current().api,r=o.oauth[t],a=r.urls;url=a.authorization+"?client_id="+r.key+"&redirect_uri="+encodeURIComponent(a.redirect)+"&response_type=token&scope=read_data_points write_data_points delete_data_points",window.location.href=url}function a(e){window.localStorage.removeItem("token-"+e)}return{isAuthenticated:n,getAccessToken:o,login:r,logoff:a}}angular.module("healthcafe.login").factory("OAuth2",e),e.$inject=["config"]}(),function(){function e(e,t,n){function o(t){return t.oauth&&(t.headers.Authorization="Bearer "+e.getAccessToken(t.oauth)),t}function r(e){var o=e.config||{};if(!o.ignoreAuthModule)switch(e.status){case 401:t.$broadcast("event:auth-unauthorized",e);break;case 403:t.$broadcast("event:auth-forbidden",e)}return n.reject(e)}return{request:o,responseError:r}}angular.module("healthcafe.login").factory("OAuth2Interceptor",e),e.$inject=["OAuth2","$rootScope","$q"]}(),function(){function e(e){function t(){o.remarks=[],e.list().then(function(e){o.remarks=e})}function n(){o.remarks=[],e.load().then(function(e){o.remarks=e})}var o=this;return o.remove=function(t){e.remove(t).then(function(){n()})},t(),o}angular.module("healthcafe.remarks").controller("RemarksController",e),e.$inject=["Remarks"]}(),function(){function e(e,t){function n(){var n=e.defer();return t.openStore("remarks",function(e){e.getAll().then(function(e){n.resolve(e)})["catch"](function(e){n.reject(e)})}),n.promise}function o(){return l?e.when(l):n()}function r(n){var o=e.defer();return t.openStore("remarks",function(e){e.get(n).then(function(e){o.resolve(e)})["catch"](function(e){o.reject(e)})}),o.promise}function a(n){var o=e.defer();return t.openStore("remarks",function(e){e["delete"](n).then(function(e){o.resolve(e)})["catch"](function(e){o.reject(e)})}),o.promise}function i(n){var o=e.defer();return t.openStore("remarks",function(e){e.insert(n).then(function(e){o.resolve(e)})["catch"](function(e){o.reject(e)})}),o.promise}var l=null;return{create:i,load:n,list:o,remove:a,get:r,defaults:function(){return{date:new Date}}}}angular.module("healthcafe.remarks").factory("Remarks",e),e.$inject=["$q","$indexedDB"]}(),function(){function e(e,t,n){var o=this;return e.model=n,angular.extend(o,t("GenericCreateController",{$scope:e})),o}angular.module("healthcafe.remarks").controller("RemarksCreateController",e),e.$inject=["$scope","$controller","Remarks"]}(),function(){function e(e,t,n){var o=this,r=e.params.service;return t.isAuthenticated(r)?void e.go("app.share",{service:r}):(o.serviceKey=r,o.service=n.sharing[r],o.login=function(){t.login(r,"/app/share/"+r)},o)}angular.module("healthcafe.sharing").controller("ConnectController",e),e.$inject=["$state","OAuth2","config"]}(),function(){function e(e,t,n,o,r,a){var l=this,c=e.params.service;if(!o.isAuthenticated(c))return t.nextViewOptions({disableBack:!0}),void e.go("app.connect",{service:c});l.serviceKey=c,l.service=r.sharing[c];var s=r.datatypes.slice();for(i in s)s[i].checked=!0;return l.datatypes=s,l.importing=!1,l["import"]=function(){l.importing=!0,a.pull(c,l.datatypes).then(function(t){l.importing=!1;var o=t.reduce(function(e,t){return e+(t?t.length:0)},0);n.alert({title:"Import succeeded",template:""+o+" data point(s) have been imported into your app."}).then(function(t){e.go("app.timeline")})})["catch"](function(t){l.importing=!1,401==t.status?n.alert({title:"Credentials expired",template:"Unfortunately your credentials have expired. Please allow the application access."}).then(function(t){o.logoff(c),e.go("app.connect",{service:c})}):n.alert({title:"Sharing error",template:"An error occurred while importing data from "+l.service.label+". Please contact an administrator.<br /><br />"+t.status+": "+t.data.error})})},l.exporting=!1,l["export"]=function(){l.exporting=!0,a.push(c,l.datatypes).then(function(t){l.exporting=!1;var o=t.reduce(function(e,t){return e+(t?t.length:0)},0);n.alert({title:"Share succeeded",template:""+o+" data point(s) have been shared with "+l.service.label+"."}).then(function(t){e.go("app.timeline")})})["catch"](function(t){l.exporting=!1,401==t.status?n.alert({title:"Credentials expired",template:"Unfortunately your credentials have expired. Please allow the application access."}).then(function(t){o.logoff(c),e.go("app.connect",{service:c})}):n.alert({title:"Sharing error",template:"An error occurred while sharing data with "+l.service.label+". Please contact an administrator.<br /><br />"+t.status+": "+t.data.error})})},l}angular.module("healthcafe.sharing").controller("ShareController",e),e.$inject=["$state","$ionicHistory","$ionicPopup","OAuth2","config","Share"]}(),function(){function e(e,t,n,o,r,a,i,l,c){function s(e,n){var r=o.sharing[e],a=d(n);if(!r)return console.error("Importing data from invalid service",e),t.reject("Importing data from invalid service");switch(r.type){case"openmhealth":return h(e,a);default:return console.error("Service type for given service is not supported",e,r.type),t.reject("Service type for given service is not supported")}}function u(e,n){var r=o.sharing[e],a=d(n);if(!r)return console.error("Exporting data to invalid service",e),t.reject("Exporting data to invalid service");switch(r.type){case"openmhealth":return m(e,a);default:return console.error("Service type for given service is not supported",e,r.type),t.reject("Service type for given service is not supported")}}function d(e){return e.filter(function(e){return e.checked}).map(function(e){switch(e.name){case"bloodpressure":return r;case"bloodglucose":return l;case"bodyweight":return a;case"cholesterol":return c;case"bmi":return i;default:return console.error("Invalid datatype selected",e.name),null}})}function h(e,r){var a=o.current().api.oauth[e];return a?t.all(r.map(function(t){var o=a.urls.dataPoints+"?schema_namespace="+encodeURIComponent(t.schema.namespace)+"&schema_name="+encodeURIComponent(t.schema.name)+"&schema_version="+encodeURIComponent(t.schema.version);return n.get(o,{oauth:e}).then(function(e){return t["import"](e.data)})})):(console.error("OAuth parameters for given service are not provided in configuration",e),t.reject("OAuth parameters for given service are not provided in configuration"))}function m(e,r){var a=o.current().api.oauth[e];return a?t.all(r.map(function(o){return o.list().then(function(r){var i=a.urls.dataPoints;return t.all(r.map(function(r){function a(e){return"object"==typeof e?e.toJSON():e}r=o.convertDates(r,a);var l=t.defer();return n.post(i,r,{oauth:e}).then(function(e){l.resolve(e)})["catch"](function(e){409==e.status?l.resolve(e):l.reject(e)}),l.promise}))})})):(console.error("OAuth parameters for given service are not provided in configuration",e),t.reject("OAuth parameters for given service are not provided in configuration"))}return{pull:s,push:u}}angular.module("healthcafe.sharing").factory("Share",e),e.$inject=["$indexedDB","$q","$http","config","BloodPressure","BodyWeight","BMI","BloodGlucose","Cholesterol"]}(),function(){function e(e,t,n,o,r,a,i,l,c,s){function u(e){e.body.effective_time_frame&&e.body.effective_time_frame.date_time?date=e.body.effective_time_frame.date_time:date=e.header.creation_date_time;var t=e.header.schema_id.name;return{id:e.header.id,datapoint:e,date:date,badgeIconClass:g[t].icon,badgeClass:e.header.schema_id.name,type:"measurement",measurementType:t,model:g[t].model,showDetail:function(){var n;switch(t){case"body-mass-index":n="bmi";break;default:n=t.replace(/-/g,"")}s.go("app."+n+"_measurement",{measurementId:e.header.id})}}}function d(e){return angular.extend({},e,{badgeIconClass:"ion-flash",badgeClass:"remark",type:"intervention",model:a,showDetail:function(){return!1}})}function h(e){var t=m(e.map(function(e){return e.map(function(e){return e.header&&e.body?u(e):d(e)})}));return t.sort(function(e,t){return new Date(t.date)-new Date(e.date)})}function m(e){return[].concat.apply([],e)}function f(e){p.loading=!0,p.events=[],i.all(e.map(function(e){return e.list()})).then(function(e){p.events=h(e)}).then(function(){p.loading=!1})}var p=this,g={"blood-pressure":{icon:"ion-heart",model:e},"body-weight":{icon:"ion-speedometer",model:t},"body-mass-index":{icon:"ion-ios-flame",model:n},"blood-glucose":{icon:"ion-fork",model:o},cholesterol:{icon:"ion-waterdrop",model:r}};return p.load=function(){var i=[e,t,o,n,r,a];f(i)},p.load(),p.remove=function(e){return confirm("Are you sure?")&&e.model.remove(e.id).then(function(){return e.removed=!0,c(function(){},200)}).then(function(){return e.model.load()}).then(function(){return p.load()}),!1},l.fromTemplateUrl("app/timeline/add_menu.html").then(function(e){p.popover=e}),p}angular.module("healthcafe.timeline").controller("TimelineController",e),e.$inject=["BloodPressure","BodyWeight","BMI","BloodGlucose","Cholesterol","Remarks","$q","$ionicPopover","$timeout","$state"]}();